import{r as s,j as e,c as _,R as H}from"./EventForm-chunk.js";import{S as J}from"./Sidebar-chunk.js";const K=({onFilter:c})=>{const[o,x]=s.useState(""),[n,u]=s.useState(""),[j,h]=s.useState([]),[S,a]=s.useState("");s.useEffect(()=>{(async()=>{try{const N=await(await fetch("/api/ref/organizations/municipalities")).json();x(N)}catch(y){console.error("Ошибка при загрузке муниципалитетов: ",y)}})()},[]),s.useEffect(()=>{if(!n){h([]);return}fetch(`/api/ref/organizations/departments?municipality=${n}`).then(t=>t.json()).then(h).catch(t=>console.error("Ошибка при загрузке департаментов",t))},[n]);const[g,r]=s.useState(!1),[w,f]=s.useState(""),[i,l]=s.useState(""),[k,b]=s.useState(!1),[v,p]=s.useState(!1),[m,F]=s.useState(!1),[P,L]=s.useState(!1),[R,z]=s.useState(!1),[M,T]=s.useState(!1),[O,I]=s.useState(""),[D,Q]=s.useState([]),[$,q]=s.useState(""),[A,B]=s.useState("");s.useEffect(()=>{fetch("/api/ref/themes").then(t=>t.json()).then(t=>Q(t)).catch(t=>console.error("Ошибка загрузки тем:",t))},[]);const U=()=>r(!g),G=()=>{function t(N){const C=new URLSearchParams;return Object.entries(N).forEach(([E,d])=>{typeof d=="string"&&d.trim()!==""?C.append(E,d.trim()):typeof d=="number"&&!isNaN(d)?C.append(E,d.toString()):typeof d=="boolean"&&d===!0&&C.append(E,"true")}),C.toString()}const y=t({municipality:n,organization:S,level:i,important:k,peerFormat:v,bestPractice:m,interagency:P,feedback:R,theme:O,financing:M,dateFrom:$,dateTo:A});c&&c(y)};return e.jsxs("div",{className:"control-panel-wrapper",children:[e.jsxs("div",{className:"control-panel",children:[e.jsx("input",{type:"text",placeholder:"Поиск мероприятий...",value:w,onChange:t=>f(t.target.value)}),e.jsx("button",{onClick:()=>window.location.href="/create",children:"Создать мероприятие"}),e.jsx("button",{onClick:U,children:g?"Скрыть фильтры":"Фильтрация"})]}),g&&e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"row",children:[e.jsxs("select",{id:"municipality",value:n,onChange:t=>u(t.target.value),children:[e.jsx("option",{value:"",children:"Выбор муниципалитета"}),o.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:S,onChange:t=>a(t.target.value),disabled:!j.length,children:[e.jsx("option",{value:"",children:"-- Выберите департамент --"}),j.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:i,onChange:t=>l(t.target.value),children:[e.jsx("option",{value:"",children:"Уровень мероприятия"}),e.jsx("option",{value:"Муниципальный",children:"Муниципальный"}),e.jsx("option",{value:"Региональный",children:"Региональный"}),e.jsx("option",{value:"Всероссийский",children:"Всероссийский"}),e.jsx("option",{value:"Международный",children:"Международный"})]})]}),e.jsxs("select",{value:O,onChange:t=>I(t.target.value),className:"theme-select",children:[e.jsx("option",{value:"",children:"Выбрать тему"}),D.map(t=>e.jsx("option",{value:t.code,title:t.description,children:t.code},t.code))]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата от:"}),e.jsx("input",{type:"date",value:$,onChange:t=>q(t.target.value)})]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата до:"}),e.jsx("input",{type:"date",value:A,onChange:t=>B(t.target.value)})]}),e.jsxs("div",{className:"checkboxes",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>b(t.target.checked)})," Важное"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:v,onChange:t=>p(t.target.checked)})," Формат равный равному"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>F(t.target.checked)})," Лучшие практики"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:P,onChange:t=>L(t.target.checked)})," Межведомственное взаимодействие"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:R,onChange:t=>z(t.target.checked)})," Обратная связь"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:M,onChange:t=>T(t.target.checked)})," Есть финансирование"]})]}),e.jsx("button",{type:"button",className:"filter-reset",onClick:()=>{f(""),u(""),a(""),l(""),I(""),b(!1),p(!1),F(!1),L(!1),z(!1),T(!1),q(""),B("")},children:"Сбросить фильтры"}),e.jsx("button",{className:"filter-submit",onClick:G,children:"Фильтровать"})]})]})};function V({data:c,error:o,loading:x}){return!c||c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"Нет данных для отображения"})}):x?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"Загрузка данных c сервера..."})}):o?e.jsx("tr",{children:e.jsxs("td",{colSpan:"10",children:["Ошибка: ",o]})}):e.jsx(e.Fragment,{children:c.map(n=>{var u;return e.jsxs("tr",{children:[e.jsx("td",{children:n.organizerName??"—"}),e.jsx("td",{children:n.themeCode??"—"}),e.jsx("td",{children:n.name??"—"}),e.jsx("td",{children:n.content??"—"}),e.jsx("td",{children:n.date??"—"}),e.jsx("td",{children:n.participantsCount??0}),e.jsx("td",{children:((u=n.links)==null?void 0:u.length)>0?n.links.map((j,h)=>e.jsx("div",{children:e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",children:j})},h)):"—"}),e.jsx("td",{children:e.jsx("button",{className:"details-btn",onClick:()=>window.location.href=`/events/${n.id}`,children:"Подробнее"})})]},n.id)})})}const W=()=>{const[c,o]=s.useState([]),[x,n]=s.useState(!0),[u,j]=s.useState(null),[h,S]=s.useState(""),[a,g]=s.useState(1),[r,w]=s.useState(1),f=async(l=1,k="")=>{n(!0);const b=new URLSearchParams(k);b.set("page",l);const v=`/api/ref/events/sort?${b.toString()}`;try{const p=await fetch(v);if(!p.ok)throw new Error("Ошибка при загрузке данных");const m=await p.json();o(m.items||m),w(m.totalPages||1),g(l)}catch(p){j(p.message)}finally{n(!1)}};s.useEffect(()=>{g(1),f(1,h)},[h]);const i=l=>{window.scrollTo({top:0,behavior:"smooth"}),f(l,h)};return e.jsxs(e.Fragment,{children:[e.jsx(K,{onFilter:l=>S(l)}),e.jsx("div",{className:"filters",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Организатор"}),e.jsx("th",{children:"№ темы"}),e.jsx("th",{children:"Наименование"}),e.jsx("th",{children:"Описание"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Количество участников"}),e.jsx("th",{children:"Ссылки"}),e.jsx("th",{children:"Управление"})]})}),e.jsx("tbody",{children:e.jsx(V,{data:c.data,error:u,loading:x})})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>i(Math.max(a-1,1)),disabled:a===1,children:"◀"}),a>2&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(1),children:"1"}),a>3&&e.jsx("span",{children:"..."})]}),a>1&&e.jsx("button",{onClick:()=>i(a-1),children:a-1}),e.jsx("button",{className:"active",children:a}),a<r&&e.jsx("button",{onClick:()=>i(a+1),children:a+1}),a<r-1&&e.jsxs(e.Fragment,{children:[a<r-2&&e.jsx("span",{children:"..."}),e.jsx("button",{onClick:()=>i(r),children:r})]}),e.jsx("button",{onClick:()=>i(Math.min(a+1,r)),disabled:a===r,children:"▶"})]})]})};function X(){const[c,o]=s.useState(!1),x=()=>o(!c);return e.jsxs("div",{className:"App",children:[e.jsx(J,{isOpen:c,toggleSidebar:x}),e.jsx(W,{})]})}const Y=document.getElementById("root"),Z=_.createRoot(Y);Z.render(e.jsxs(H.StrictMode,{children:[e.jsx(X,{})," "]}));
