import{r as a,j as e,c as N}from"./EventForm-chunk.js";import{t as l}from"./toastr.min-chunk.js";const z=()=>{const[r,c]=a.useState(""),[n,f]=a.useState(""),[g,i]=a.useState(!1),[u,x]=a.useState([]),[d,j]=a.useState(!0),[h,w]=a.useState(null),m=u.filter(t=>t.toLowerCase().includes(r.toLowerCase())),y=t=>{c(t.target.value),i(!0)},v=t=>{c(t),i(!1)};if(a.useEffect(()=>{(async()=>{const s="/api/ref/auth/organizations";try{const o=await fetch(s);if(!o.ok)throw new Error("Ошибка при загрузке данных");const p=await o.json();console.log("Полученные организации:",p),x(p)}catch(o){w(o.message)}finally{j(!1)}})()},[]),d)return d;if(h)return h;const S=async t=>{if(t.preventDefault(),!r||!n.trim()){l.error("Введите организацию и пароль","Ошибка");return}u.find(s=>s===r);try{const s=await fetch("/api/ref/auth/authorize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationName:r,password:n})});if(!s.ok)throw new Error(await s.text());const o=await s.text();alert(o),localStorage.setItem("tokenATK",o.token),l.success("Успешный вход!","Добро пожаловать"),window.location.href="/events"}catch(s){l.error(s.message||"Ошибка входа","Ошибка")}};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-card",children:[e.jsx("div",{className:"login-image",children:e.jsxs("video",{autoPlay:!0,muted:!0,loop:!0,playsInline:!0,children:[e.jsx("source",{src:"/images/fon.mp4",type:"video/mp4"}),"Ваш браузер не поддерживает видео."]})}),e.jsxs("form",{className:"login-form",onSubmit:S,autoComplete:"off",children:[e.jsx("h2",{children:"Авторизация"}),e.jsx("label",{htmlFor:"organization",children:"Организация"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",id:"organization",value:r,onChange:y,onFocus:()=>i(!0),placeholder:"Введите или выберите из списка"}),g&&m.length>0&&e.jsx("ul",{className:"autocomplete-list",children:m.map(t=>e.jsx("li",{onClick:()=>v(t),className:"autocomplete-item",children:t},t))})]}),e.jsx("input",{type:"password",placeholder:"Пароль",value:n,onChange:t=>f(t.target.value)}),e.jsx("div",{className:"actions",children:e.jsx("button",{type:"submit",className:"primary-btn",children:"Войти"})})]})]})})};N.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(z,{})}));
